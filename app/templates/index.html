  {% extends "base.html" %}
    
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    
    {% set title = 'ScraperWiki MOT Vehicle Fault Search' %}
    

    <!-- Bootstrap -->
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    

    {% block content %}
    <script>
      
      var makeText;
      var modelText;

      $(function(){
        options = '<option>Select a car make</option>';
        var keys = {{ make|safe }};
        keys.sort();
        $.each(keys, function(index, value){options += '<option value="'+ value +'">' + value + '</option>';})
        $("#make").html(options);          
       });
      
      function getModel(e){        
        options = '<option>Select model</option>';
        var e = document.getElementById("make");
        makeText = e.options[e.selectedIndex].text;        
        $.ajax('/make',{
          type: 'POST',
          data: JSON.stringify({make: makeText}, null, '\t'),
          contentType: 'application/json;charset=UTF-8',
          success: function(result) {
          var keys = $.parseJSON(result);
          keys.sort();
          $.each(keys, function(index, value){options += '<option value="'+ value +'">' + value + '</option>';})
          $("#model").html(options);
        }
        });
      }

      function getYear(e){        
        options = '<option>Select a year</option>';
        var e = document.getElementById("model");
        modelText = e.options[e.selectedIndex].text;        
        $.ajax('/make/model',{
          type: 'POST',
          data: JSON.stringify({make: makeText, model: modelText}, null, '\t'),
          contentType: 'application/json;charset=UTF-8',
          success: function(result) {
          var year_keys = $.parseJSON(result);
          year_keys.sort();
          $.each(year_keys, function(index, value){options += '<option value="'+ value +'">' + value + '</option>';})      
          $("#year").html(options);
        }
        });
      }

      $(function(){
        $('#make').change(getModel);
      });

      $(function(){
        $('#model').change(getYear);
      });      
      
    </script>  


    <!-- BANNER -->
            <legend id="banner" class="advert" data-section="1">
                <div class="banner-container">
                    <content class="banner-col">
                        <h2 class="banner-title">I want to buy a new <span id="banner-typeset" class="text-blue"></span></h2>                     
                        <h3 class="banner-subtitle">What's the pass rate of and the typical faults discovered with this car at MOT testing?</h3>
                        <h3 class="banner-subtitle1">At ScraperWiki, using data science, weâ€™ll tell you.</h3>
                    </content><!-- .banner-col-centered -->
                </div><!-- .banner-container -->                
            </legend><!-- .banner-section -->
    <form method="POST">
    <fieldset>

    <!-- Form Name -->
    
    <!-- Car Make Selection -->
    <div class="indexbody">
    <div class="control-group">
      <label id="maketext"class="control-label" for="car-make-input" style="font-size:25px">Which vehicle <b>Make</b> do you want to know about?</label>
      <div class="controls">
        <div class="input-append">
          <!--<input id="car-make-input" name="car-make-input" class="input-xlarge" placeholder="e.g. Ford" type="text" required="">-->
          <div class="btn-group">
            <select id="make" class="selectbasic" name="make">
              
            </select>
          </div>
        </div>
      </div>
    </div>

    <!-- Car Model Selection -->
    <div class="control-group">
      <label class="control-label" for="car-model-input" style="font-size:25px">What <b>Model</b>?</label>
      <div class="controls">
        <div class="input-append">
          <!--<input id="car-make-input" name="car-make-input" class="input-xlarge" placeholder="e.g. Fiesta" type="text" required="">-->
          <div class="btn-group">
            <select id="model" class="selectbasic" name="model"></select>
          </div>
        </div>
      </div>
    </div>

    <!-- Year first on road Selection -->
    <div class="control-group">
      <label class="control-label" for="car-model-input" style="font-size:25px">Filter by <b>Year</b> the car was first on the road (optional)</label>
      <div class="controls">
        <div class="input-append">
          <!--<input id="car-make-input" name="car-make-input" class="input-xlarge" placeholder="e.g. Fiesta" type="text" required="">-->
          <div class="btn-group">
            <select id="year" class="selectbasic" name="year"></select>
          </div>
        </div>
      </div>
    </div>

    <!-- Search Buttons -->
    <div class="form-group">
      <label class="col-md-4 control-label" for="submit-button"></label>
      <div class="col-md-4">
        <input id="submit-button" name="submit-button" class="btn btn-primary" type="submit" value="Display Top Faults"></input>
        <input id="submit-button2" name="submit-button" class="btn btn-primary" type="submit" value="Display Pass Rate"></input>
      </div>

    </div>
    <div id="indeximage">
    <img src="{{ url_for('static', filename = 'indeximage.jpg') }}" alt="Responsive image"> 
    </div> 
    </div> 

    </fieldset>
    </form>

{% endblock %}
